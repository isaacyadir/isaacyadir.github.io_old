<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script defer src="https://use.fontawesome.com/releases/v5.13.0/js/all.js"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.79.1" />


<title>Web scraping with Beautiful Soup: Plebiscito Colombia (October 2nd) - Dr. Juan Camilo Orduz</title>
<meta property="og:title" content="Web scraping with Beautiful Soup: Plebiscito Colombia (October 2nd) - Dr. Juan Camilo Orduz">


  <link href='../images/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="../css/fonts.css" media="all">
<link rel="stylesheet" href="../css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="../" class="nav-logo">
    <img src="../images/sphere2.gif"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="../about/"> About</a></li>
    
    <li><a href="https://github.com/juanitorduz"><i class='fab fa-github fa-2x'></i>  </a></li>
    
    <li><a href="https://www.linkedin.com/in/juanitorduz/"><i class='fab fa-linkedin fa-2x' style='color:#0077B5;'></i>  </a></li>
    
    <li><a href="https://twitter.com/juanitorduz"><i class='fab fa-twitter fa-2x' style='color:#1DA1F2;'></i>  </a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">6 min read</span>
    

    <h1 class="article-title">Web scraping with Beautiful Soup: Plebiscito Colombia (October 2nd)</h1>

    
    <span class="article-date">2017-07-09</span>
    

    <div class="article-content">
      <h1 id="web-scraping-getting-referendum-data-using-beautiful-soup">Web scraping: Getting referendum data using Beautiful Soup</h1>
<p>In this post I am going to describe how to get the data of the peace <a href="https://en.wikipedia.org/wiki/Colombian_peace_agreement_referendum,_2016">referendum</a> (which happened in October the 2nd in Colombia)  from the <a href="http://plebiscito.registraduria.gov.co/99PL/DPLZZZZZZZZZZZZZZZZZ_L1.htm">official government website</a> using <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#">Beautiful Soup</a> in python (this a task was suggested by <a href="https://co.linkedin.com/in/sebasti%C3%A1n-mart%C3%ADnez-00184649">Sebastian Martinez</a>). The data is not directly available but is represened as follows:</p>
<!-- raw HTML omitted -->
<p>The aim is to get the percentages of votes for each town in Colombia by scraping the website.</p>
<p><strong>Warning:</strong> I want to emphasize that this post <strong>does not</strong> involve analizing the data or getting conclusions from it. These kind of analysis should be done carefully and responsibly.</p>
<h2 id="step-1-setting-up-the-enviorment">Step 1: Setting up the enviorment.</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># This is the principal website of the referendum. </span>
url_main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://plebiscito.registraduria.gov.co&#34;</span>

<span style="color:#75715e"># This is the complete url of the website of the referendum. </span>
url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://plebiscito.registraduria.gov.co/99PL/DPLZZZZZZZZZZZZZZZZZ_L1.htm&#34;</span>
</code></pre></div><p>The html code of <em>url</em> looks like:</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
<span style="color:#f92672">import</span> requests

<span style="color:#75715e"># This function gets the html of the website. </span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_soup</span>(s):
    r  <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(s)
    data <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>text
    soup <span style="color:#f92672">=</span> BeautifulSoup(data, <span style="color:#e6db74">&#34;lxml&#34;</span>)
    <span style="color:#66d9ef">return</span> soup


soup <span style="color:#f92672">=</span> get_soup(url)
</code></pre></div><h2 id="step-2-getting-the-departments-states-information">Step 2: Getting the departments (states) information</h2>
<p>Here we pick the information of each department as a list.
Each element of the list is of type bs4.element.Tag</p>
<p><em>Remark:</em> You need to explore thr html code to find out that <code>find_all(&quot;option&quot;)[56:90]</code> actually gets the departments names.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">departments_soup <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;option&#34;</span>)[<span style="color:#ae81ff">56</span>:<span style="color:#ae81ff">90</span>]
</code></pre></div><p>We construct from the departments_soup a pandas DataFrame.
It contains two columns:</p>
<ol>
<li>The name of the department.</li>
<li>The path to each department result page (where detailed infromation is provided).</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

departments <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(columns<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;Department&#34;</span>, <span style="color:#e6db74">&#34;path&#34;</span>))

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range (<span style="color:#ae81ff">0</span>,len(departments_soup)):
    row<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>Series(dict(zip([<span style="color:#e6db74">&#34;Department&#34;</span>, <span style="color:#e6db74">&#34;path&#34;</span>],
                           [departments_soup[i]<span style="color:#f92672">.</span>get_text(),
                            departments_soup[i][<span style="color:#e6db74">&#34;value&#34;</span>]])))
    row<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> i
    departments <span style="color:#f92672">=</span> departments<span style="color:#f92672">.</span>append(row)

<span style="color:#75715e"># Let us see the result.    </span>
departments
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
    font-size: 14px;
}

.dataframe tbody tr th {
    vertical-align: top;
    font-size: 14px;
}

.dataframe tbody tr td {
    vertical-align: top;
    font-size: 14px;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Looking into the data we see that there are two deparments (Nariño and Norte de Santander) with misspellings.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">departments<span style="color:#f92672">.</span>loc[<span style="color:#ae81ff">22</span>,<span style="color:#e6db74">&#34;Department&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;NARIÑO&#34;</span>
departments<span style="color:#f92672">.</span>loc[<span style="color:#ae81ff">23</span>,<span style="color:#e6db74">&#34;Department&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;NORTE DE SANTANDER&#39;</span>
</code></pre></div><p>From each department path we construct the real url and store it in a new column in the deparments DataFrame called &ldquo;url&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">construct_complete_url</span>(path):
    complete_url <span style="color:#f92672">=</span> url_main <span style="color:#f92672">+</span> path<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;..&#34;</span>)[<span style="color:#ae81ff">1</span>]
    <span style="color:#66d9ef">return</span> complete_url

departments[<span style="color:#e6db74">&#34;url&#34;</span>]<span style="color:#f92672">=</span>departments[<span style="color:#e6db74">&#34;path&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: construct_complete_url(x))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Let us see the head of the resulting DataFrame.</span>
departments<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>We create a new column in the deparments DataFrame called <em>soup</em>. This column stores a soup object obtained from their corresponding url.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> departments[<span style="color:#e6db74">&#34;soup&#34;</span>]<span style="color:#f92672">=</span>departments[<span style="color:#e6db74">&#34;url&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : get_soup(x))
</code></pre></div><h2 id="step-3-getting-the--towns-information">Step 3: Getting the  towns information</h2>
<p>We make from the departments a pandas DataFrame of towns. It contains three columns:</p>
<ol>
<li>The name of the department.</li>
<li>The name of the town.</li>
<li>The path to each department result.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">towns <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(columns<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;Department&#34;</span>, <span style="color:#e6db74">&#34;Town&#34;</span>, <span style="color:#e6db74">&#34;path&#34;</span>))

<span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,departments<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]):
    
    towns_in_department <span style="color:#f92672">=</span> departments[<span style="color:#e6db74">&#34;soup&#34;</span>][j]<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;option&#34;</span>)[<span style="color:#ae81ff">36</span>:]
    
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range (<span style="color:#ae81ff">0</span>,len(towns_in_department)):
        dept <span style="color:#f92672">=</span> departments<span style="color:#f92672">.</span>loc[j,<span style="color:#e6db74">&#34;Department&#34;</span>]
        town_name <span style="color:#f92672">=</span> towns_in_department[i]<span style="color:#f92672">.</span>get_text()
        town_path <span style="color:#f92672">=</span> towns_in_department[i][<span style="color:#e6db74">&#34;value&#34;</span>]
        row <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series(dict(zip([<span style="color:#e6db74">&#34;Department&#34;</span>, <span style="color:#e6db74">&#34;Town&#34;</span>, <span style="color:#e6db74">&#34;path&#34;</span>],[dept,town_name,town_path])))
        towns <span style="color:#f92672">=</span> towns<span style="color:#f92672">.</span>append(row, ignore_index<span style="color:#f92672">=</span>True)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Let us see the structure for the first 20 towns.</span>
towns<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">20</span>)
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>We create a new column in the towns DataFrame called <em>url</em>. This coumn stores the real url for each town.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">towns[<span style="color:#e6db74">&#34;url&#34;</span>]<span style="color:#f92672">=</span>towns[<span style="color:#e6db74">&#34;path&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: construct_complete_url(x))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Let us see the result.</span>
towns<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="step-4-get-votes">Step 4: Get votes</h2>
<p>Now that we have access to each town website results, we are going to get the percentage of yes, no and null votes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># This function transform the vote string of the function below </span>
<span style="color:#75715e"># in order to get an integer. </span>

<span style="color:#75715e"># To understan the logic of this function you need to understand </span>
<span style="color:#75715e"># the structure of the html code.</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_vote_int_from_string</span>(vote_string, is_null_votes):
    
    <span style="color:#66d9ef">if</span>(is_null_votes):
        num_v <span style="color:#f92672">=</span> vote_string<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;Votos nulos&#34;</span>)[<span style="color:#ae81ff">1</span>]
    <span style="color:#66d9ef">else</span>:
        num_v <span style="color:#f92672">=</span> vote_string<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;(&#34;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>split( )[<span style="color:#ae81ff">0</span>]
    
    num <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(num_v<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;.&#34;</span>)) 
    <span style="color:#66d9ef">return</span> int(num)
    
<span style="color:#75715e"># This function gets the votation information.</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_votes</span>(u):
    s<span style="color:#f92672">=</span>get_soup(u)
    
    yes <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;div&#34;</span>, class_<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;skill-bar-percent&#34;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>get_text()
    no <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;div&#34;</span>, class_<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;skill-bar-percent&#34;</span>)[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>get_text()
    null <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;div&#34;</span>, class_<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cajaInfTercera&#34;</span>)[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;div&#34;</span>, class_<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;contenido&#34;</span>)[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>get_text()

    votes <span style="color:#f92672">=</span> (get_vote_int_from_string(yes, False), 
             get_vote_int_from_string(no, False),
             get_vote_int_from_string(null, True))
    
    <span style="color:#66d9ef">return</span> votes
</code></pre></div><p>We create a new column in the towns DataFrame called <em>votes</em> which stores the information in a tuple.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">towns[<span style="color:#e6db74">&#34;votes&#34;</span>]<span style="color:#f92672">=</span>towns[<span style="color:#e6db74">&#34;url&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : get_votes(x))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">towns<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Next we get the yes, no and null votes separately. We also compute the total of votes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># We get YES. </span>
towns[<span style="color:#e6db74">&#34;YES&#34;</span>] <span style="color:#f92672">=</span> towns[<span style="color:#e6db74">&#34;votes&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : x[<span style="color:#ae81ff">0</span>])

<span style="color:#75715e"># We get NO. </span>
towns[<span style="color:#e6db74">&#34;NO&#34;</span>] <span style="color:#f92672">=</span> towns[<span style="color:#e6db74">&#34;votes&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : x[<span style="color:#ae81ff">1</span>])

<span style="color:#75715e"># We get NULL. </span>
towns[<span style="color:#e6db74">&#34;NULL&#34;</span>] <span style="color:#f92672">=</span> towns[<span style="color:#e6db74">&#34;votes&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : x[<span style="color:#ae81ff">2</span>])

<span style="color:#75715e"># We comute the total (sum). </span>
towns[<span style="color:#e6db74">&#34;TOTAL&#34;</span>] <span style="color:#f92672">=</span> towns[<span style="color:#e6db74">&#34;votes&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x : sum(x))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Let us see the final strcuture. </span>
towns<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h1 id="step-5-export-the-data-into-a-csv-file">Step 5: Export the data into a csv file</h1>
<p>We export the towns DataFrame into a .csv file with all the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">columns_to_print <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Department&#34;</span>, <span style="color:#e6db74">&#34;Town&#34;</span>, <span style="color:#e6db74">&#34;YES&#34;</span>, <span style="color:#e6db74">&#34;NO&#34;</span>, <span style="color:#e6db74">&#34;NULL&#34;</span>, <span style="color:#e6db74">&#34;TOTAL&#34;</span>]

towns[columns_to_print]<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;resultados.csv&#34;</span>, index<span style="color:#f92672">=</span>False)
</code></pre></div><h1 id="step-6-data-exploration">Step 6: Data Exploration</h1>
<p>Let us see how to begin a simple exploration of the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;resultados.csv&#34;</span>, index_col<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Department&#34;</span>)

data<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>In order to get information from each department we group the results by adding the total votes for each category.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_departments <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>groupby(data<span style="color:#f92672">.</span>index)<span style="color:#f92672">.</span>sum()
</code></pre></div><p>Now we compute basic ratios of the results.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_departments[<span style="color:#e6db74">&#34;YES/TOTAL&#34;</span>] <span style="color:#f92672">=</span> results_departments[<span style="color:#e6db74">&#34;YES&#34;</span>]<span style="color:#f92672">/</span>results_departments[<span style="color:#e6db74">&#34;TOTAL&#34;</span>]
results_departments[<span style="color:#e6db74">&#34;NO/TOTAL&#34;</span>] <span style="color:#f92672">=</span> results_departments[<span style="color:#e6db74">&#34;NO&#34;</span>]<span style="color:#f92672">/</span>results_departments[<span style="color:#e6db74">&#34;TOTAL&#34;</span>]

results_departments<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="visualization">Visualization</h3>
<p>Here we plot the <code>YES/TOTAL</code> ratio for all the departments.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">%</span>matplotlib inline

results_departments<span style="color:#f92672">.</span>plot(y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL&#34;</span>,
                         kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>,
                         stacked<span style="color:#f92672">=</span>True,
                         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL per Department&#34;</span>,
                         ylim<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1.0</span>),
                         figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">12</span>))
plt<span style="color:#f92672">.</span>pyplot<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</code></pre></div><pre><code>(array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
        17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33]),
 &lt;a list of 34 Text xticklabel objects&gt;)
</code></pre>
<p><img src="plebiscito_files/plebiscito_40_1.png" alt="png"></p>
<p>Here we plot the <code>TOTAL</code> votation for all the departments.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_departments<span style="color:#f92672">.</span>plot(y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TOTAL&#34;</span>, 
                         kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>,
                         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Total Votes per Department&#34;</span>,
                         figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">12</span>))
plt<span style="color:#f92672">.</span>pyplot<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</code></pre></div><pre><code>(array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
        17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33]),
 &lt;a list of 34 Text xticklabel objects&gt;)
</code></pre>
<p><img src="plebiscito_files/plebiscito_42_1.png" alt="png"></p>
<p>Now we want to get information within each department.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_towns <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>copy()

results_towns[<span style="color:#e6db74">&#34;YES/TOTAL&#34;</span>]<span style="color:#f92672">=</span>results_towns[<span style="color:#e6db74">&#34;YES&#34;</span>]<span style="color:#f92672">/</span>results_towns[<span style="color:#e6db74">&#34;TOTAL&#34;</span>]
results_towns[<span style="color:#e6db74">&#34;NO/TOTAL&#34;</span>]<span style="color:#f92672">=</span>results_towns[<span style="color:#e6db74">&#34;NO&#34;</span>]<span style="color:#f92672">/</span>results_towns[<span style="color:#e6db74">&#34;TOTAL&#34;</span>]

results_towns<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Here we plot the <code>YES/TOTAL</code> ratio for the deparment <code>CHOCO</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_towns[results_towns<span style="color:#f92672">.</span>index<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;CHOCO&#34;</span>]<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Town&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL&#34;</span>,
                                                  kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>, 
                                                  title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL for CHOCO&#34;</span>,
                                                  figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">12</span>),
                                                  ylim<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1.0</span>))
</code></pre></div><!-- raw HTML omitted -->
<p>Here we plot the <code>YES/TOTAL</code> ratio for the deparment <code>CHOCO</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results_towns[results_towns<span style="color:#f92672">.</span>index<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;CALDAS&#34;</span>]<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Town&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL&#34;</span>,
                                                  kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>, 
                                                  title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES/TOTAL for CALDAS&#34;</span>,
                                                  figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">12</span>),
                                                  ylim<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1.0</span>))
</code></pre></div><!-- raw HTML omitted -->
<p>As mentioned in the introduction, now that the data is available it is necessary to make a detailed and structured study of these results. For example, mapping these results to education level, precense of the guerrilla, etc. Of course, this is something which, for now, is beyond the scope of this post.</p>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="../index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="../images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122570825-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

